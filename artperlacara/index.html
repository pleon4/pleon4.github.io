<!DOCTYPE html>
<!.. Indica que el document és HTML5 -->
<html>
<head>
<!-- La secció head conté metadades i enllaços a fitxers externs -->

<meta charset="UTF-8">
<!-- Defineix la codificació de caràcters a UTF-8, que suporta accents i símbols especials -->

<title>Art Geomètric amb Mini Cara i Text Gran</title>
<!-- Defineix el títol de la pàgina que apareixerà a la pestanya del navegador -->

<!-- Llibreries necessàries: s'inclouen des de servidors externs -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.11.3/p5.js"></script>
<!-- Aquesta és la biblioteca p5.js, que facilita la creació de gràfics i animacions en el navegador -->

<script src="https://cdn.jsdelivr.net/gh/ml5js/Intro-ML-Arts-IMA@ml5-build-10-7-19/ml5_build/ml5.min.js"></script>
<!-- Aquesta és la biblioteca ml5.js, que ens permet utilitzar models d'intel·ligència artificial com la detecció facial -->

<style>
/*Inici del codi CSS per donar estil a la pàgina*/

body {
margin: 0;
padding: 0;
backfround-color: #f4f4f4;
/+ Fons de color gris clar*/
display: flex;
flex-direction: column;
align-items: center;
/*La pàgina està centrada i es distribueixen els elements en columna*/
}

/*Estils per a la pantlla de càrrega que es mostra abans que es carreguin els models*/
#loading-screen {
position: fixed;
/* La pantalla de càrrega es manté fixa en tot moment a la finestra del navegador*/
top: 0;
left: 0;
width: 100%;
height: 100%;
background: rgba(255,255,255,0.9);
/* Fons blanc amb lleugera transparència */ display: flex;
flex-direction: column;
justify-content: center;
align-items: center;
/* Centra el contingut de la pantalla (loader i text) */ font-family: Arial, sans-serif;
font-size: 18px:
color: #333;
/* Text en gris fosc per a bona llegibilitat */ Z-index: 10;
/* Es col-loca per sobre de tot el contingut (amb un index z alt) */
}
.loader {
width: 50px;
height: 50px;
border: 6px solid #3498db;
/* Marge de 6 píxels de grosor amb color blau (part de la vora) */ 
 border-top: 6px solid transparent;
/* La part superior és transparent per fer l'efecte giratori */ 
 border-radius: 50%;
/* Fa el loader circular */ 
 animation: spin 1s linear infinite;
/* Aplica una animació que fa girar l'element indefinidament */ 
 margin-bottom: 10px;
/* Declaració de la keyframe de l'animació per girar l'element loader */ 
@keyframes spin {
0% { transform: rotate(0deg); }
100% { transform: rotate(360deg); }
}
/* Fi de l'estil CSS */ 
</style>
</head>
<body>
<!-- Cos del document: aquí es col loca el contingut visible a la página -->

<!-- Pantalla de carrega: s'exhibeix mentre es carteguen els models de detecció facial --> 
<div id="loading-screen">
<div class="loader"></div>
<!-- Element visual que gira per mostrar que s'està carregant --> 
<p> Carregant models, si us plau, espera...</p>
<!-- Missatge per informar a l'usuari que s'està carregant el model -> 
</div>
  
<script>
/* Inici del codi JavaScript */
  
// Declarem variables globals utilitzades en el codi
let faceapi;
// Aquesta variable emmagatzemarà el model de detecció facial de mlS.js
  
let detections = [];
// Array on es guardaran els resultats (deteccions) que ens proporciona el model facial
  
let video;
// Variable que guardarà la captura de vídeo de la càmera
  
let modelsMostrats = false;
// Variable booleana per controlar si ja s'ha amagat la pantalla de carrega
  
// Variables per a la mida de la mini image de la cara que es mostrarà
const miniWidth = 120;
const miniHeight = 120;
  
// Funció setup de p5.js, s'executa una vegada al principi
function setup() {
// Creem un canvas (llindar per dibuixos) de 600x600 píxels
// createCanvas(600, 600);
  
createCanvas window Width, windowHeight); // Canvi aquí
  
// Iniciem la captura de vídeo des de la càmera de l'usuari
video = createCapture(VIDEO);
video.size(480, 480);
// Es defineix la mida del video
video.hide();
// Amaguem el vídeo perquè només s'utilitzi per processar la imatge, no per mostrar-lo
directament
  
// Opcions per a la detecció facial (configuració del model)
const faceOptions = {
withLandmarks: true, // Detecta els punts clau de la cara (ulls, nas, boca, etc.)
withExpressions: true, // Detecta les expressions facials (felicitat, tristesa, etc.)
withDescriptors: false, // No sol-licita descriptors facials (informació per reconèixer
cares)
minConfidence: 0.5 // Nivell mínim de certesa per considerar una detecció valida};
  
// Inicializa el model de detecció facial amb el vídeo i les opcions definides
faceapi = ml5.faceApi(video, faceOptions, faceReady);
// Quan el model estigui preparat, es cridarà la funció faceReady
}

// Funció que s'executa quan el model de detecció facial està llest
function faceReady() {
faceapi.detect(gotF aces);
// Inicia la detecció facial cridant la funció gotFaces quan es completen les deteccions
}

function windowResized() {
resizeCanvas(window Width, windowHeight); // Nova funció per adaptar el canvas
}
  
// Funció que s'executa cada cop que ml5.js té les deteccions d'una cara
funcion gotFaces(error, result){
if (error) {
console.error(error);
// En cas d'error, s'imprimeix a la consola i es deté l'execució
return;
}

detections = result;
// Guarda el resultat de les deteccions (poden ser múltiples cares, però en aquest cas s'utilitza la primera)
if (ImodelsMostrats) {
// Si encara no s'ha amagat la pantalla de càrrega...
document.getElementById("loading-screen").style.display = "none";
// ...amaguem l'element amb id "loading-screen"
modelsMostrats = true;
// Actualitzem la variable perquè no es torni a amagar més tard (ja ho hem fet)
}

// Torna a iniciar la detecció facial de forma contínua
faceapi detect(gotFaces);
 }

// Funció draw de p5.js, s'executa moltes vegades per segon per actualitzar la pantalla
function draw() {
// Es pinta el fons de color blanc cada vegada que es redibuixa el canvas
background(255);
  
// Variables per emmagatzemar el sentiment (expressió facial) i la seva intensitat
let dominant = "neutre";
let intensity = 0;
  
// Si hi ha deteccions i almenys una cara
if (detections && detections.length > 0) {
// Es recuperen les expressions facials de la primera detecció
let expr = detections[0].expressions;
// Es determina quina és l'expressió dominant (amb més probabilitat) comparant els
valors
dominant = Object.keys(expr).reduce((a, b) => expr[a] > expr[b]? a : b);
// També s'extreu la intensitat de l'expressió dominant
intensity = expr[dominant];
}
  
// Es dibuixa art geomètric diferent segons el sentiment detectat
drawDifferentArt(dominant, intensity);
  
// Dibuixa un text amb el nom de l'expressió facial a la part superior del canvas
noStroke();
fill(44, 169, 225);
textSize(48);
textAlign(CENTER, CENTER);

</html>
